<script type="text/javascript">

	$(document).ready(function() {

		let cnfSites = {
    		model 	: 'components',
    		method 	: 'sitios',
    		params	: {
    			val	: $('#slcCliente').val(), 
    			def : $('#hidIdSite').val(),
    			typ : 'echo'
    		},
    		target	: 'slcProyecto'
    	};

		cmbdep(cnfSites);
		
		let cnfComp = {
    		model 	: 'components',
    		method 	: 'compos',
    		params	: {
    			val	: $('#slcCategoria').val(), 
    			fam	: $('#slcFamilia').val(), 
    			def : $('#hidIdCompo').val(),
    			typ : 'echo'
    		},
    		target	: 'slcComponente'
    	};

		cmbdep(cnfComp);		

	});
	
	$(document).on('change','#slcCliente',function(){

    	let cnf = {
    		model 	: 'components',
    		method 	: 'sitios',
    		params	: {
    			val	: $(this).val(), 
    			def : '',
    			typ : 'echo'
    		},
    		target	: 'slcProyecto'
    	};

    	cmbdep(cnf);

	});
	
	$(document).on('change','#slcCategoria',function(){

		let cnf = {
    		model 	: 'components',
    		method 	: 'compos',
    		params	: {
    			val	: $(this).val(), 
    			fam	: $('#slcFamilia').val(), 
    			def : '',
    			typ : 'echo'
    		},
    		target	: 'slcComponente'
    	};

    	cmbdep(cnf);

	});

	$(document).on('change','#slcComponente',function(){

		var params = {
			'model'  : 'components',
			'method' : 'control',
			'args'   : $(this).val()
		};

		$.ajax({
			url: 'index.php',
			type: 'POST',
			dataType: 'html',
			data: params,
			cache: false, // Appends _={timestamp} to the request query string
			success: function($dres) {
				$('#fboxes').html($dres);
			}
		}).done(function() {

			let flds = '';
			
			$(".ctrl-fld").each(function(i) {
				flds += $(this).attr('id')+',';
			});

			$('#hidCtrlFdls').val(flds);
			
		});

	});

</script>

{header}

<br>

<div class="col-lg-12">

	<div class="card">

		<div class="card-header d-flex align-items-center">
			<h3 class="h4">Editar componente</h3>
		</div>

		<div class="card-body">

			<p>Los campos marcados con asterisco <b class="text-danger">*</b> son <b class="text-danger">requeridos</b> </p>

			<div id="rowMsg" class="row hidden-row">
				<div class="col-lg-12">
					<div id="contMsg" class="alert alert-danger"></div>
				</div>
			</div>

			<form id="components" name="components" action="guardar">

				<input type="hidden" id="hidId" name="hidId" value="{id}">
				<input type="hidden" id="hidIdSite" name="hidIdSite" value="{siteId}">
				<input type="hidden" id="hidIdCompo" name="hidIdCompo" value="{idComponent}">
				<input type="hidden" name="hidCtrlFdls" id="hidCtrlFdls" value="{lfld}">

				<div class="row">

					<div class="col-lg-4">
						<div class="form-group">
						<label class="form-control-label">Cliente <span class="text-danger">*</span></label>
						<select id="slcCliente" name="slcCliente" class="form-control cliente" required>{empresas}</select>
						<input type="hidden" name="hidCliente" id="hidCliente" class="clihid">
						</div>
					</div>
			
					<div class="col-lg-8">
						<div class="form-group">
						<label class="form-control-label">Proyecto/Mina <span class="text-danger">*</span></label>
						<select id="slcProyecto" name="slcProyecto" class="form-control proyecto"required></select>
						<input type="hidden" name="hidProyecto" id="hidProyecto" class="proyhid">
						</div>
					</div>
			
				</div>

				<div class="row">

					<div class="col-lg-4">
						<div class="form-group">
							<label class="form-control-label">Tipo de sistema <span class="text-danger">*</span></label>
							<select id="slcTySys" name="slcTySys" class="form-control" required>{sistemas}</select>
						</div>
					</div>
			
					<div class="col-lg-4">
						<div class="form-group">
							<label class="form-control-label">Familia <span class="text-danger">*</span></label>
							<select id="slcFamilia" name="slcFamilia" class="form-control" required>{familias}</select>
						</div>
					</div>

					<div class="col-lg-4">
						<div class="form-group">
							<label class="form-control-label">Categor√≠a <span class="text-danger">*</span></label>
							<select id="slcCategoria" name="slcCategoria" class="form-control" required>{categs}</select>
						</div>
					</div>

				</div>

				<div class="row">

					<div class="col-lg-8">
						<div class="form-group">
							<label class="form-control-label">Componente <span class="text-danger">*</span></label>
							<select id="slcComponente" name="slcComponente" class="form-control" required></select>
						</div>
					</div>

					<div class="col-lg-4">
						<div class="form-group">
							<label class="form-control-label">Estado componente <span class="text-danger">*</span></label>
							<select id="slcEstado" name="slcEstado" class="form-control" required="">{estados}</select>
						</div>
					</div>

				</div>

				<br>

				<div class="row">
					<div class="col-lg-4">
						<h4>Campos de control</h4>
					</div>
				</div>

				<br>

				<div id="fboxes" class="row">{fbox}</div>

		      	<br>

			</form>

		</div>

		<div class="card-footer text-right">

			<button id="btnSave" type="button" class="btn btn-success" model="components" method="guardar" form="0" target="module-cont">
				Guardar &nbsp;&nbsp;<i class="fa fa-save"></i>
			</button>

			&nbsp;&nbsp;

			<button id="btnCancel" type="button" class="btn btn-danger" action="back" modbak="index" target="module-cont">
				Cancelar &nbsp;&nbsp;<i class="fa fa-times"></i>
			</button>

		</div>

	</div>

</div>

{footer}